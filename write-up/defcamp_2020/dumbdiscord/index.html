<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="map[name:ABH]">
<meta name="description" content="Context : This week-end, I participated in the Defcamp Capture the Flag 2020 with my team RootMeUpBeforeYouGoGo We have been ranked 10th.
I did this challenge with my team-mates Grillette and DSpiricate.
Description Well here is an example of a funny discord bot.
Solution We are given a Python compiled bytecode file
To decompile it, I used Decompiler.com and it gave me this :
# uncompyle6 version 3.7.4 # Python bytecode 3." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#2A3D75" />
<link rel="canonical" href="https://www.abhw0rld.com/write-up/defcamp_2020/dumbdiscord/" />


    <title>
        
            DefCamp Capture the Flag 2020 - Dumb Discord :: ABHw0rld&#39;s blog  â€” Cybersecurity addict !
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.393856bf2c430bb6c01d7af07c6fe966e7cce8073435cfbbc46e590bab7405ef.css">






<meta itemprop="name" content="DefCamp Capture the Flag 2020 - Dumb Discord">
<meta itemprop="description" content="Context : This week-end, I participated in the Defcamp Capture the Flag 2020 with my team RootMeUpBeforeYouGoGo We have been ranked 10th.
I did this challenge with my team-mates Grillette and DSpiricate.
Description Well here is an example of a funny discord bot.
Solution We are given a Python compiled bytecode file
To decompile it, I used Decompiler.com and it gave me this :
# uncompyle6 version 3.7.4 # Python bytecode 3.">
<meta itemprop="datePublished" content="2020-12-07T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-12-07T00:00:00+00:00" />
<meta itemprop="wordCount" content="397">



<meta itemprop="keywords" content="" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="DefCamp Capture the Flag 2020 - Dumb Discord"/>
<meta name="twitter:description" content="Context : This week-end, I participated in the Defcamp Capture the Flag 2020 with my team RootMeUpBeforeYouGoGo We have been ranked 10th.
I did this challenge with my team-mates Grillette and DSpiricate.
Description Well here is an example of a funny discord bot.
Solution We are given a Python compiled bytecode file
To decompile it, I used Decompiler.com and it gave me this :
# uncompyle6 version 3.7.4 # Python bytecode 3."/>



    <meta property="og:title" content="DefCamp Capture the Flag 2020 - Dumb Discord" />
<meta property="og:description" content="Context : This week-end, I participated in the Defcamp Capture the Flag 2020 with my team RootMeUpBeforeYouGoGo We have been ranked 10th.
I did this challenge with my team-mates Grillette and DSpiricate.
Description Well here is an example of a funny discord bot.
Solution We are given a Python compiled bytecode file
To decompile it, I used Decompiler.com and it gave me this :
# uncompyle6 version 3.7.4 # Python bytecode 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.abhw0rld.com/write-up/defcamp_2020/dumbdiscord/" />
<meta property="article:published_time" content="2020-12-07T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-12-07T00:00:00+00:00" /><meta property="og:site_name" content="ABHw0rld&#39;s blog" />







    <meta property="article:published_time" content="2020-12-07 00:00:00 &#43;0000 UTC" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ ./ABH_enter.world </span>
            <span class="logo__cursor" style=
                  "
                   background-color:#00FEFE;
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://www.abhw0rld.com/me">Me</a></li><li><a href="https://www.abhw0rld.com/write-up/">Writeups</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://www.abhw0rld.com/write-up/defcamp_2020/dumbdiscord/">DefCamp Capture the Flag 2020 - Dumb Discord</a></h2>

            

            

            <div class="post-content">
                <h2 id="context-">Context :</h2>
<p>This week-end, I participated in the Defcamp Capture the Flag 2020 with my team <a href="https://twitter.com/RMUBYGG">RootMeUpBeforeYouGoGo</a>
We have been ranked 10th.</p>
<p>I did this challenge with my team-mates <a href="https://twitter.com/0xGrillette">Grillette</a> and <a href="https://twitter.com/DSpiricate">DSpiricate</a>.</p>
<h2 id="description">Description</h2>
<p>Well here is an example of a funny discord bot.</p>
<h2 id="solution">Solution</h2>
<p>We are given a Python compiled bytecode <a href="/srcwu/dumbdiscord/challenge.pyc">file</a></p>
<p>To decompile it, I used <a href="http://www.decompiler.com/">Decompiler.com</a> and it gave me this :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#75715e"># uncompyle6 version 3.7.4</span>
<span style="color:#75715e"># Python bytecode 3.6 (3379)</span>
<span style="color:#75715e"># Decompiled from: Python 2.7.17 (default, Sep 30 2020, 13:38:04) </span>
<span style="color:#75715e"># [GCC 7.5.0]</span>
<span style="color:#75715e"># Warning: this version of Python has problems handling the Python 3 &#34;byte&#34; type in constants properly.</span>

<span style="color:#75715e"># Embedded file name: server.py</span>
<span style="color:#75715e"># Compiled at: 2020-12-02 03:30:35</span>
<span style="color:#75715e"># Size of source mod 2**32: 1909 bytes</span>
<span style="color:#f92672">from</span> discord.ext <span style="color:#f92672">import</span> commands
<span style="color:#f92672">import</span> discord<span style="color:#f92672">,</span> json
<span style="color:#f92672">from</span> discord.utils <span style="color:#f92672">import</span> get

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">obfuscate</span>(byt):
    mask <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ctf{tryharderdontstring}&#39;</span>
    lmask <span style="color:#f92672">=</span> len(mask)
    <span style="color:#66d9ef">return</span> bytes(c <span style="color:#f92672">^</span> mask[(i <span style="color:#f92672">%</span> lmask)] <span style="color:#66d9ef">for</span> i, c <span style="color:#f92672">in</span> enumerate(byt))


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test</span>(s):
    data <span style="color:#f92672">=</span> obfuscate(s<span style="color:#f92672">.</span>encode())
    <span style="color:#66d9ef">return</span> data


intents <span style="color:#f92672">=</span> discord<span style="color:#f92672">.</span>Intents<span style="color:#f92672">.</span>default()
intents<span style="color:#f92672">.</span>members <span style="color:#f92672">=</span> True
cfg <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;config.json&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>)
tmpconfig <span style="color:#f92672">=</span> cfg<span style="color:#f92672">.</span>read()
cfg<span style="color:#f92672">.</span>close()
config <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(tmpconfig)
token <span style="color:#f92672">=</span> config[test(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x17\x1b\r\x1e\x1a</span><span style="color:#e6db74">&#39;</span>)<span style="color:#f92672">.</span>decode()]
client <span style="color:#f92672">=</span> commands<span style="color:#f92672">.</span>Bot(command_prefix<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/&#39;</span>)

<span style="color:#a6e22e">@client.event</span>
async <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_ready</span>():
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Connected to bot: {}&#39;</span><span style="color:#f92672">.</span>format(client<span style="color:#f92672">.</span>user<span style="color:#f92672">.</span>name))
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Bot ID: {}&#39;</span><span style="color:#f92672">.</span>format(client<span style="color:#f92672">.</span>user<span style="color:#f92672">.</span>id))


<span style="color:#a6e22e">@client.command</span>()
async <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getflag</span>(ctx):
    await ctx<span style="color:#f92672">.</span>send(test(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x13\x1b\x08\x1c</span><span style="color:#e6db74">&#39;</span>)<span style="color:#f92672">.</span>decode())


<span style="color:#a6e22e">@client.event</span>
async <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_message</span>(message):
    await client<span style="color:#f92672">.</span>process_commands(message)
    <span style="color:#66d9ef">if</span> test(<span style="color:#e6db74">&#39;B</span><span style="color:#ae81ff">\x04\x0f\x15\x13</span><span style="color:#e6db74">&#39;</span>)<span style="color:#f92672">.</span>decode() <span style="color:#f92672">in</span> message<span style="color:#f92672">.</span>content<span style="color:#f92672">.</span>lower():
        await message<span style="color:#f92672">.</span>channel<span style="color:#f92672">.</span>send(test(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x13\x1b\x08\x1c</span><span style="color:#e6db74">&#39;</span>)<span style="color:#f92672">.</span>decode())
    <span style="color:#66d9ef">if</span> test(<span style="color:#e6db74">&#39;L</span><span style="color:#ae81ff">\x13\x03\x0f\x12\x1e\x18\x0f</span><span style="color:#e6db74">&#39;</span>)<span style="color:#f92672">.</span>decode() <span style="color:#f92672">in</span> message<span style="color:#f92672">.</span>content<span style="color:#f92672">.</span>lower():
        <span style="color:#66d9ef">if</span> message<span style="color:#f92672">.</span>author<span style="color:#f92672">.</span>id <span style="color:#f92672">==</span> <span style="color:#ae81ff">783473293554352141L</span>:
            role <span style="color:#f92672">=</span> discord<span style="color:#f92672">.</span>utils<span style="color:#f92672">.</span>get((message<span style="color:#f92672">.</span>author<span style="color:#f92672">.</span>guild<span style="color:#f92672">.</span>roles), name<span style="color:#f92672">=</span>(test(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x07\x17\x12\x1d</span><span style="color:#e6db74">FBKXO</span><span style="color:#ae81ff">\x11\x1d\x07\x17\x16\n\n\x01</span><span style="color:#e6db74">]</span><span style="color:#ae81ff">\x06\x1d</span><span style="color:#e6db74">&#39;</span>)<span style="color:#f92672">.</span>decode()))
            member <span style="color:#f92672">=</span> discord<span style="color:#f92672">.</span>utils<span style="color:#f92672">.</span>get((message<span style="color:#f92672">.</span>author<span style="color:#f92672">.</span>guild<span style="color:#f92672">.</span>members), id<span style="color:#f92672">=</span>(message<span style="color:#f92672">.</span>author<span style="color:#f92672">.</span>id))
            <span style="color:#66d9ef">if</span> role <span style="color:#f92672">in</span> member<span style="color:#f92672">.</span>roles:
                await message<span style="color:#f92672">.</span>channel<span style="color:#f92672">.</span>send(test(config[test(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x05\x18\x07\x1c</span><span style="color:#e6db74">&#39;</span>)<span style="color:#f92672">.</span>decode()]))
    <span style="color:#66d9ef">if</span> test(<span style="color:#e6db74">&#39;L</span><span style="color:#ae81ff">\x1c\x03\x17\x04</span><span style="color:#e6db74">&#39;</span>)<span style="color:#f92672">.</span>decode() <span style="color:#f92672">in</span> message<span style="color:#f92672">.</span>content<span style="color:#f92672">.</span>lower():
        await message<span style="color:#f92672">.</span>channel<span style="color:#f92672">.</span>send(test(<span style="color:#e6db74">&#39;7</span><span style="color:#ae81ff">\x06\x1f</span><span style="color:#e6db74">[</span><span style="color:#ae81ff">\x1c\x13\x0b\x0c\x04\x00</span><span style="color:#e6db74">E&#39;</span>)<span style="color:#f92672">.</span>decode())
    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;/s</span><span style="color:#ae81ff">\u57fa</span><span style="color:#e6db74">ay&#39;</span> <span style="color:#f92672">in</span> message<span style="color:#f92672">.</span>content<span style="color:#f92672">.</span>lower():
        await message<span style="color:#f92672">.</span>channel<span style="color:#f92672">.</span>send(message<span style="color:#f92672">.</span>content<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;/s</span><span style="color:#ae81ff">\u57fa</span><span style="color:#e6db74">ay&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(test(<span style="color:#e6db74">&#39;L</span><span style="color:#ae81ff">\x13\x03\x0f\x12\x1e\x18\x0f</span><span style="color:#e6db74">&#39;</span>)<span style="color:#f92672">.</span>decode(), <span style="color:#e6db74">&#39;&#39;</span>))


client<span style="color:#f92672">.</span>run(token)
</code></pre></div><p>It is a basic python discord bot.</p>
<p>We have a function obfuscating strings, I re-used this function to de-obfuscate some bot&rsquo;s strings :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@client.event</span>
async <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_message</span>(message):
    await client<span style="color:#f92672">.</span>process_commands(message)
    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;!ping&#39;</span> <span style="color:#f92672">in</span> message<span style="color:#f92672">.</span>content<span style="color:#f92672">.</span>lower():
        await message<span style="color:#f92672">.</span>channel<span style="color:#f92672">.</span>send(<span style="color:#e6db74">&#39;pong&#39;</span>)
    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;/getflag&#39;</span> <span style="color:#f92672">in</span> message<span style="color:#f92672">.</span>content<span style="color:#f92672">.</span>lower():
        <span style="color:#66d9ef">if</span> message<span style="color:#f92672">.</span>author<span style="color:#f92672">.</span>id <span style="color:#f92672">==</span> <span style="color:#ae81ff">783473293554352141L</span>:
            role <span style="color:#f92672">=</span> discord<span style="color:#f92672">.</span>utils<span style="color:#f92672">.</span>get((message<span style="color:#f92672">.</span>author<span style="color:#f92672">.</span>guild<span style="color:#f92672">.</span>roles), name<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;dctf2020.cyberedu.ro&#39;</span>))
            member <span style="color:#f92672">=</span> discord<span style="color:#f92672">.</span>utils<span style="color:#f92672">.</span>get((message<span style="color:#f92672">.</span>author<span style="color:#f92672">.</span>guild<span style="color:#f92672">.</span>members), id<span style="color:#f92672">=</span>(message<span style="color:#f92672">.</span>author<span style="color:#f92672">.</span>id))
            <span style="color:#66d9ef">if</span> role <span style="color:#f92672">in</span> member<span style="color:#f92672">.</span>roles:
                await message<span style="color:#f92672">.</span>channel<span style="color:#f92672">.</span>send(test(config[<span style="color:#e6db74">&#39;flag&#39;</span>]))
    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;/help&#39;</span> <span style="color:#f92672">in</span> message<span style="color:#f92672">.</span>content<span style="color:#f92672">.</span>lower():
        await message<span style="color:#f92672">.</span>channel<span style="color:#f92672">.</span>send(<span style="color:#e6db74">&#39;Try harder!&#39;</span>)
    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;/s</span><span style="color:#ae81ff">\u57fa</span><span style="color:#e6db74">ay&#39;</span> <span style="color:#f92672">in</span> message<span style="color:#f92672">.</span>content<span style="color:#f92672">.</span>lower():
        await message<span style="color:#f92672">.</span>channel<span style="color:#f92672">.</span>send(message<span style="color:#f92672">.</span>content<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;/s</span><span style="color:#ae81ff">\u57fa</span><span style="color:#e6db74">ay&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;/getflag&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>))
</code></pre></div><p>So, the bot&rsquo;s id is probably 783473293554352141 and we have to make it send <code>/getflag</code>.
Moreover, it needs to have the role : <code>dctf2020.cyberedu.ro</code>.</p>
<p>When we send it <code>u'/s\u57faay'</code>, the bot send what we said after removing <code>u'/s\u57faay'</code> and <code>/getflag</code> from our message.</p>
<p>Then, we simply have to send <code>u'/s\u57faay'+'/get/getflagflag'</code></p>
<p>With the id&rsquo;s bot we can simply invite him into our discord server with this link :</p>
<p><a href="https://discord.com/oauth2/authorize?client_id=783473293554352141&amp;permissions=8&amp;scope=bot">https://discord.com/oauth2/authorize?client_id=783473293554352141&amp;permissions=8&amp;scope=bot</a></p>
<p><img src="/srcwu/dumbdiscord/dumbdiscord2.png" alt="/getFlag"></p>
<p>Finally, with the obfuscate function we get the flag :</p>
<p><img src="/srcwu/dumbdiscord/dumbdiscord3.png" alt="Le Flag !"></p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2021</span>
            
            <span><a href="https://www.abhw0rld.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span><a href="https://www.abhw0rld.com/me">ABH</a></span>
          </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js" integrity="sha512-3HFukJLJggt3&#43;W2ilNASCu6xibW86pdSMJ6&#43;on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script>



    </body>
</html>
